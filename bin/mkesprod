#!/bin/sh

# find out where Skeleton is installed on a system
sroot=`python -c "import Skeletons; print '/'.join(Skeletons.__file__.split('/')[:-1])"`
# run actual script
if  [ "$1" == "-h" ] || [ "$1" == "--help" ] || [ "$1" == "-help" ]; then
    python $sroot/main.py --help | egrep -v "template|tmpl"
    echo "\nExample: mkesprod --name=MyProducer"
    exit
fi
test_env()
{
    base=`env | grep CMSSW_BASE`
    cmssw=`echo "$base/src" | sed -e "s,//,/,g" -e "s,CMSSW_BASE=,,g"`
    ldir=`echo $PWD | sed "s,$cmssw,,g"`
    if  [ -z "$ldir" ] || [ ! -d "..$ldir" ]; then
        echo ""
        echo "Packages must be created in a 'subsystem'."
        echo "Please set your CMSSW environment and go to $CMSSW_BASE/src"
        echo "Create or choose directory from there and then "
        echo "run the script from that directory"
    fi
}
test_env
python $sroot/main.py --tmpl=ESProducer --tmpl=$0/mkTemplates ${1+"$@"}
